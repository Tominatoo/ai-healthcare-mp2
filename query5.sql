SELECT t.GENDER, AVG(t.age) 
FROM (SELECT *, DATEDIFF(DOD, DOB) / 365 AS age
      FROM PATIENTS
      WHERE EXPIRE_FLAG=1
      HAVING age < 120) t
GROUP BY t.GENDER
